services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: s001_qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    networks:
      - s001_network

  rag_agent:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: s001_rag_agent
    environment:
      # Everything here is correct and points to the qdrant service name
      QDRANT_HOST: "${QDRANT_HOST}"
      QDRANT_PORT: "${QDRANT_PORT}"
      QDRANT_URL: "http://${QDRANT_HOST}:${QDRANT_PORT}"

      # Subtle: app loads this at runtime (not a Compose env override)
      APP_CONFIG_PATH: "/app/config/environment.yml"

    command: ["sh", "-lc", "python app.py || true; sleep infinity"]
    depends_on:
      - qdrant
    networks:
      - s001_network

networks:
  s001_network:
    driver: bridge

volumes:
  qdrant_data:
